{% extends "layout.html" %}
{% block title %}{{ playlist.name }}{% endblock %}
{% block content %}
    <h1>{{ playlist.name }}</h1>
    
    <p>Description: {{ playlist.description }}</p>
    <p>Sort order: {{ playlist.sortOrder }}</p>
    <p>Favorite: {{ playlist.favorite }}</p>
    <p>AllowDuplicates: {{ playlist.allowDuplicates }}</p>
    <p>QueueStream count: {TODO{ len(playlist.streamIds) }}</p>
    <p>StreamSource count: {TODO{ len(playlist.streamSourceIds) }}</p>
    <p>LastWatchedIndex: {{ playlist.lastWatchedIndex }}</p>
    <p>Added: {{ playlist.added }}</p>

    <div class="row">
        <form action="/play/{{ playlist.id }}">
            <input type="number" name="index" id="index" placeholder="Index" />
            <button type="submit">Play index</button>
        </form>
    </div>
    <div class="row">
        <a href="{{ url_for("fetchPlaylist", playlistId=playlist.id) }}">
            <button>Fetch (new only)</button>
        </a>
        <a href="{{ url_for("prunePlaylist", playlistId=playlist.id) }}">
            <button>Prune</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Purge</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Purge Fetch</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Download</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Export</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Unwatch all</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>Edit</button>
        </a>
        <a href="{{ url_for("playlistsDelete", id=playlist.id) }}">
            <button>Delete</button>
        </a>
    </div>
    
    <div class="row">
        {% if playlist.deleted %}
            <p>Soft deleted: {{ playlist.deleted }}</p>
            <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
                <button>Restore from soft delete</button>
            </a>
        {% endif %}
    </div>

    <div class="row">
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>New StreamSource</button>
        </a>
        <a href="{{ url_for("error", errorMessage=NotImplemented) }}">
            <button>New QueueStream</button>
        </a>
    </div>
    
    <h1>QueueStreams in {{ playlist.name }}</h1>
    <hr>
    {% if not enumerateQueueStreams %}
        No QueueStreams
    {% else %}
        <table>
            <tr>
                <th>Index</th>
                <th>Details</th>
                <th>Source</th>
                <th>Play from here</th>
                <th>Watched?</th>
            </tr>
            {% for i, queueStream in enumerateQueueStreams: %}
                <tr>
                    <td>{{ i }}</td>
                    <td><a href="{{ url_for("queueStreamsDetails", id=queueStream.id) }}">{{ queueStream.name }}</a></td>
                    {% if queueStream.streamSourceId %}
                        <td><a href="{{ url_for("streamSourcesDetails", id=queueStream.streamSourceId) }}">{{ queueStream.streamSourceName }}</a></td>
                    {% else %}
                        <td></td>
                    {% endif %}
                    <td><a href="{{ url_for("play", playlistId= playlist.id, index= i) }}">Play from here</a></td>
                    {% if queueStream.watched %}
                        <td>Yes</td>
                    {% else %}
                        <td></td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <h1>StreamSources in {{ playlist.name }}</h1>
    <hr>
    {% if streamSources|length == 0 %}
        No StreamSources
    {% else %}
        <table>
            <tr>
                <th>Details</th>
                <th>URI</th>
                <th>Fetching?</th>
            </tr>
            {% for streamSource in streamSources: %}
                <tr>
                    <td><a href="{{ url_for("streamSourcesDetails", id=streamSource.id) }}">{{ streamSource.name }}</a></td>
                    {% if streamSource.uri %}
                        <td><a href="{{ streamSource.uri }}" target="_blank">Open</a></td>
                    {% else %}
                        <td></td>
                    {% endif %}
                    {% if streamSource.enableFetch %}
                        <td>Yes</td>
                    {% else %}
                        <td></td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}
{% endblock %}